#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Verificando testes modificados..."

# Encontra arquivos de teste modificados (staged para commit)
changed_specs=$(git diff --cached --name-only | grep -E '^cypress/e2e/.*\.(cy|spec)\.(js|ts)$') || true

if [ -z "$changed_specs" ]; then
  echo "ğŸ“¦ Nenhum teste e2e modificado (staged). Nenhuma aÃ§Ã£o necessÃ¡ria."
  exit 0
fi

# Junta os caminhos em uma lista separada por vÃ­rgula
specs=$(echo "$changed_specs" | paste -sd "," -)

echo "ğŸš€ Executando os testes modificados:"
echo "$specs"

# Executa os testes modificados
if npx cypress run --spec "$specs"; then
  echo "âœ… Testes passaram!"
else
  echo "âŒ Testes falharam. Ã‰ necessÃ¡rio corrigir antes de fazer o push."
  exit 1
fi
